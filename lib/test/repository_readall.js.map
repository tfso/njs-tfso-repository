{"version":3,"file":"repository_readall.js","sourceRoot":"","sources":["../../src/test/repository_readall.ts"],"names":[],"mappings":"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","sourcesContent":["import * as assert from 'assert';\r\nimport Repository from './../repository/baserepository';\r\nimport Enumerable, { IEnumerable } from './../linq/enumerable';\r\n\r\ndescribe(\"When using repository to read all\", () => {\r\n    var repository: CarRepository;\r\n\r\n    beforeEach(() => {\r\n        repository = new CarRepository();\r\n    })\r\n\r\n    it(\"should handle non existing where\", () => {\r\n        var list = repository.exposeFilters(new Enumerable<ICar>().skip(5).take(3))\r\n\r\n        assert.ok(list != null, \"expected filters\")\r\n        assert.ok(list.length == 0, \"Expected 0 filter\")\r\n    })\r\n\r\n    it(\"should handle multiple or/and expressions\", () => {\r\n        var list = repository.exposeFilters(new Enumerable<ICar>().where((car: ICar) => car.registrationYear >= 2016 || car.location == 'NO' && car.registrationYear > 2000 && car.id != null && (car.registrationYear > 2000 || car.registrationYear == 1999)))\r\n\r\n        assert.ok(list.length == 0, \"Expected non common filters\")\r\n    })\r\n\r\n    it(\"should return a single filter\", () => {\r\n        var list = repository.exposeFilters(new Enumerable<ICar>().where((car: ICar) => car.location == 'PORSGRUNN'));\r\n\r\n        assert.ok(list.length == 1, \"Expected one criteria\");\r\n    })\r\n\r\n    it(\"should return a single filter with two criteria\", () => {\r\n        var list = repository.exposeFilters(new Enumerable<ICar>().where((car: ICar) => car.registrationYear > 2015 && car.location == 'PORSGRUNN'));\r\n\r\n        assert.ok(list.length == 2, \"Expected two criteria\");\r\n    })\r\n\r\n    it(\"should return a criteria using property to be equal value\", () => {\r\n        var list = repository.exposeFilters(new Enumerable<ICar>().where((car: ICar) => car.location == 'NO'));\r\n\r\n        assert.ok(list.length == 1, \"Expected a single criteria\");\r\n        assert.ok(list[0].property == \"location\", \"Expected property to be 'location'\");\r\n        assert.ok(list[0].value == \"NO\", \"Expected value to be 'NO'\");\r\n    })\r\n\r\n    it(\"should return a criteria using property to be greater than value\", () => {\r\n        var list = repository.exposeFilters(new Enumerable<ICar>().where((car: ICar) => car.registrationYear > 2000));\r\n\r\n        assert.ok(list.length == 1, \"Expected a single criteria\");\r\n        assert.ok(list[0].property == \"registrationYear\", \"Expected property to be 'registrationYear'\");\r\n        assert.ok(list[0].value == 2000, \"Expected value to be 2000\");\r\n        assert.ok(list[0].operator == \">\", \"Expected operator to be greater than\");\r\n    })\r\n\r\n    it(\"should return a criteria using property to be greater than value just the other way around\", () => {\r\n        var list = repository.exposeFilters(new Enumerable<ICar>().where((car: ICar) => 2000 < car.registrationYear));\r\n\r\n        assert.ok(list.length == 1, \"Expected a single criteria\");\r\n        assert.ok(list[0].property == \"registrationYear\", \"Expected property to be 'registrationYear'\");\r\n        assert.ok(list[0].value == 2000, \"Expected value to be 2000\");\r\n        assert.ok(list[0].operator == \">\", \"Expected operator to be greater than\");\r\n    })\r\n\r\n    //it(\"should cast an exception if a unsolvable expression is used\", () => {\r\n    //    assert.throws(\r\n    //        () => {\r\n    //            repository.exposeFilters(new Enumerable<ICar>().where((car: ICar) => this.unknown == 5));\r\n    //        },\r\n    //        Error\r\n    //    );\r\n    //})\r\n\r\n    it(\"should intersection filter properties that is common \", () => {\r\n        var intersection = repository.exposeFilters(new Enumerable<ICar>().where((car: ICar) => (car.registrationYear == 2015 && car.location == 'NO') || car.registrationYear == 2015 || (car.location == 'SE' && car.registrationYear == 2015)));\r\n        \r\n        assert.ok(intersection.length == 1, \"Expected one criteria from intersection\");\r\n        assert.ok(intersection[0].property == \"registrationYear\", \"Expected property to be 'registrationYear'\");\r\n    })\r\n\r\n    it(\"should intersection filter properties that is not common\", () => {\r\n        var intersection = repository.exposeFilters(new Enumerable<ICar>().where((car: ICar) => (car.registrationYear > 2015 && car.location == 'NO') || car.registrationYear == 2015 || (car.location == 'SE' && car.registrationYear == 2015)));\r\n\r\n        assert.ok(intersection.length == 0, \"Expected zero criteria from intersection\");\r\n    })\r\n\r\n    it(\"should handle method calls\", () => {\r\n        var list = repository.exposeFilters(new Enumerable<ICar>().where((car: ICar) => car.location.toLowerCase() == \"no\"));\r\n\r\n        if (Date.now() < new Date(2019, 5, 1).getTime())\r\n            return;\r\n\r\n        assert.ok(false);\r\n\r\n        //assert.ok(list.length == 1, \"Expected a single criteria\");\r\n        //assert.ok(list[0].method == \"toLowerCase\");\r\n    })\r\n\r\n    it(\"should handle some unary expressions\", () => {\r\n        var list = repository.exposeFilters(new Enumerable<ICar>().where( (it, date) => +it.registrationDate == +date, new Date(2017,11,1)))\r\n\r\n        assert.equal(list.length, 1);\r\n        assert.equal(list[0].property, 'registrationDate')\r\n        assert.equal(list[0].operator, '==');\r\n        assert.equal(list[0].value.toISOString(), new Date(2017,11,1).toISOString());\r\n    })\r\n\r\n    it(\"should handle nested member expressions\", () => {\r\n        var list = repository.exposeFilters(new Enumerable<ICar>().where(car => car.type.make == \"Toyota\"));\r\n\r\n        assert.equal(list.length, 1);\r\n        assert.equal(list[0].property, 'type.make')\r\n        assert.equal(list[0].operator, '==');\r\n        assert.equal(list[0].value, 'Toyota');\r\n\r\n    })\r\n});\r\n\r\n\r\ninterface ICar {\r\n\r\n    id: number\r\n    location: string\r\n\r\n    registrationYear: number\r\n    registrationDate: Date\r\n\r\n    type: {\r\n        make: string\r\n        model: string\r\n    }\r\n}\r\n\r\nclass CarRepository extends Repository<ICar, number>\r\n{\r\n    constructor() {\r\n        super();\r\n    }\r\n\r\n    public read(id) {\r\n        return Promise.reject<ICar>(new Error('Not implemented'));\r\n    }\r\n\r\n    public readAll(predicate) {\r\n        return Promise.reject<ICar[]>(new Error('Not implemented'));\r\n    }\r\n\r\n    public delete(entity) {\r\n        return Promise.reject<boolean>(new Error('Not implemented'));\r\n    }\r\n\r\n    public update(entity) {\r\n        return Promise.reject<boolean>(new Error('Not implemented'));\r\n    }\r\n\r\n    public create(entity: ICar) {\r\n        return Promise.reject<ICar>(new Error('Not implemented'));\r\n    }\r\n\r\n    public exposeFilters(query: IEnumerable<ICar>) {\r\n        return super.getCriteria(query);\r\n    }\r\n}"]}