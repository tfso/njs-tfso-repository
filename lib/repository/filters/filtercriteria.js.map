{"version":3,"file":"filtercriteria.js","sourceRoot":"","sources":["../../../src/repository/filters/filtercriteria.ts"],"names":[],"mappings":"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","sourcesContent":["import { IExpression, ExpressionType, ILogicalExpression, LogicalOperatorType, IMemberExpression, ILiteralExpression, IIdentifierExpression } from './../../linq/expressions/expressionvisitor';\r\n\r\nexport interface IFilterCriteria {\r\n    property: string\r\n    operator: string\r\n    value: any\r\n    wildcard: 'none' | 'left' | 'right' | 'both'\r\n    isValid: boolean\r\n}\r\n\r\nexport class FilterCriteria implements IFilterCriteria {\r\n    private _expression: ILogicalExpression;\r\n\r\n    constructor(expression: ILogicalExpression) {\r\n        this._expression = expression;\r\n    }\r\n\r\n    protected get expression() {\r\n        return this._expression;\r\n    }\r\n\r\n    protected getMemberName(expression: IExpression): string {\r\n        switch (expression.type)\r\n        {\r\n            case ExpressionType.Identifier:\r\n                return (<IIdentifierExpression>expression).name;\r\n\r\n            case ExpressionType.Member:\r\n                return `${this.getMemberName((<IMemberExpression>expression).object)}.${this.getMemberName((<IMemberExpression>expression).property)}`;\r\n\r\n            default:\r\n                return '';\r\n        }\r\n    }\r\n\r\n    public get property() {\r\n        switch (this._expression.left.type) {\r\n            case ExpressionType.Identifier:\r\n            case ExpressionType.Member:\r\n                return this.getMemberName(this._expression.left);\r\n\r\n            case ExpressionType.Literal:\r\n\r\n                switch (this._expression.right.type) {\r\n                    case ExpressionType.Identifier:\r\n                    case ExpressionType.Member:\r\n                        return this.getMemberName(this._expression.right);\r\n\r\n                    default:\r\n                        return \"\";\r\n\r\n                }\r\n\r\n            default:\r\n                return \"\";\r\n        }\r\n    }\r\n\r\n    public get wildcard() {\r\n        let value = String(this.getValue())\r\n\r\n        if(value.startsWith('*') && value.endsWith('*')) \r\n            return 'both'\r\n        else if(value.startsWith('*'))\r\n            return 'left'\r\n        else if(value.endsWith('*'))\r\n            return 'right'\r\n            \r\n        return 'none'\r\n    }\r\n\r\n    public get operator() {\r\n        switch (this._expression.left.type) {\r\n            case ExpressionType.Identifier:\r\n            case ExpressionType.Member:\r\n                switch (this._expression.operator) {\r\n                    case LogicalOperatorType.Equal:\r\n                        return \"==\";\r\n\r\n                    case LogicalOperatorType.NotEqual:\r\n                        return \"!=\";\r\n\r\n                    case LogicalOperatorType.Greater:\r\n                        return \">\";\r\n\r\n                    case LogicalOperatorType.GreaterOrEqual:\r\n                        return \">=\";\r\n\r\n                    case LogicalOperatorType.Lesser:\r\n                        return \"<\";\r\n\r\n                    case LogicalOperatorType.LesserOrEqual:\r\n                        return \"<=\";\r\n                }\r\n\r\n                return null;\r\n\r\n            case ExpressionType.Literal:\r\n                switch (this._expression.operator) {\r\n                    case LogicalOperatorType.Equal:\r\n                        return \"==\";\r\n\r\n                    case LogicalOperatorType.NotEqual:\r\n                        return \"!=\";\r\n\r\n                    case LogicalOperatorType.Greater:\r\n                        return \"<\";\r\n\r\n                    case LogicalOperatorType.GreaterOrEqual:\r\n                        return \"<=\";\r\n\r\n                    case LogicalOperatorType.Lesser:\r\n                        return \">\";\r\n\r\n                    case LogicalOperatorType.LesserOrEqual:\r\n                        return \">=\";\r\n                }\r\n\r\n                break;\r\n\r\n            default:\r\n                return null;\r\n        }\r\n    }\r\n\r\n    public get value() {\r\n        return this.cleanWildcard(this.getValue())\r\n    }\r\n\r\n    private getValue() {\r\n        switch (this._expression.left.type) {\r\n            case ExpressionType.Literal:\r\n                return (<ILiteralExpression>this._expression.left).value;\r\n\r\n            case ExpressionType.Identifier:\r\n            case ExpressionType.Member:\r\n                switch (this._expression.right.type) {\r\n                    case ExpressionType.Literal:\r\n                        return (<ILiteralExpression>this._expression.right).value;\r\n\r\n                    default:\r\n                        return null;\r\n                }\r\n\r\n            default:\r\n                return null;\r\n        }\r\n    }\r\n\r\n    public get isValid() {\r\n        // requires \"member.property [comparison operator] literal\" for now\r\n\r\n        switch (this._expression.left.type) {\r\n            case ExpressionType.Identifier:\r\n                switch (this._expression.right.type) {\r\n                    case ExpressionType.Literal:\r\n                        return true;\r\n\r\n                    default:\r\n                        return false;\r\n                }\r\n\r\n            case ExpressionType.Member:\r\n\r\n                if ((<IMemberExpression>this._expression.left).object.type == ExpressionType.Identifier && (<IMemberExpression>this._expression.left).property.type == ExpressionType.Identifier) {\r\n\r\n                    switch (this._expression.right.type) {\r\n                        case ExpressionType.Literal:\r\n                            return true;\r\n\r\n                        default:\r\n                            return false;\r\n                    }\r\n\r\n                } else {\r\n                    return false;\r\n                }\r\n\r\n            case ExpressionType.Literal:\r\n\r\n                switch (this._expression.right.type) {\r\n                    case ExpressionType.Member:\r\n                        if ((<IMemberExpression>this._expression.right).object.type == ExpressionType.Identifier && (<IMemberExpression>this._expression.right).property.type == ExpressionType.Identifier)\r\n                            return true;\r\n                        else\r\n                            return false;\r\n\r\n                    default:\r\n                        return false;\r\n                }\r\n\r\n            default:\r\n                return false;\r\n        }\r\n    }\r\n\r\n    public static visit(expression: ILogicalExpression): Array<IFilterCriteria> {\r\n        var result: Array<IFilterCriteria> = [];\r\n\r\n        switch (expression.operator) {\r\n            case LogicalOperatorType.Or:\r\n                return result;\r\n\r\n            case LogicalOperatorType.And:\r\n                if (expression.left.type == ExpressionType.Logical)\r\n                    result = result.concat(FilterCriteria.visit(<ILogicalExpression>expression.left));\r\n\r\n                if (expression.right.type == ExpressionType.Logical)\r\n                    result = result.concat(FilterCriteria.visit(<ILogicalExpression>expression.right));\r\n\r\n                break;\r\n\r\n            default:\r\n                result.push(new FilterCriteria(expression));\r\n                break;\r\n        }\r\n\r\n        return result.filter((criteria) => criteria.isValid);\r\n    }\r\n\r\n    private cleanWildcard(value: any) {\r\n        if(typeof value == 'string') {\r\n\r\n            let match = /^\\*?(.*?)\\*?$/.exec(value)\r\n            if(match) {\r\n                return match[1]\r\n            }\r\n\r\n            return value\r\n        }\r\n\r\n        return value\r\n    }\r\n}"]}