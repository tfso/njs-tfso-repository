{"version":3,"file":"expressionvisitor.js","sourceRoot":"","sources":["../../../src/linq/expressions/expressionvisitor.ts"],"names":[],"mappings":"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","sourcesContent":["import ODataParser from './../../lib/odata-parser';\r\nimport JavascriptParser from './../../lib/javascript-parser';\r\n\r\nimport { IExpressionVisitor, IExpressionStack } from './interfaces/iexpressionvisitor'\r\n\r\nimport { IExpression, Expression, ExpressionType } from './expression';\r\nimport { ILiteralExpression, LiteralExpression } from './literalexpression';\r\nimport { IIndexExpression, IndexExpression } from './indexexpression';\r\nimport { ICompoundExpression } from './compoundexpression';\r\nimport { IIdentifierExpression, IdentifierExpression } from './identifierexpression';\r\nimport { IMemberExpression, MemberExpression } from './memberexpression';\r\nimport { IMethodExpression, MethodExpression } from './methodexpression';\r\nimport { IUnaryExpression, UnaryExpression, UnaryOperatorType, UnaryAffixType } from './unaryexpression';\r\nimport { IBinaryExpression, BinaryExpression, BinaryOperatorType } from './binaryexpression';\r\nimport { ILogicalExpression, LogicalExpression, LogicalOperatorType } from './logicalexpression';\r\nimport { IConditionalExpression, ConditionalExpression } from './conditionalexpression';\r\nimport { IArrayExpression, ArrayExpression } from './arrayexpression';\r\nimport { ITemplateLiteralExpression, TemplateLiteralExpression } from './templateliteralexpression';\r\nimport { IObjectExpression, ObjectExpression, IObjectProperty} from './objectexpression';\r\n\r\nimport { LambdaExpression } from './lambdaexpression';\r\n\r\n\r\nexport class ExpressionStack implements IExpressionStack {\r\n    private items: Array<IExpression>;\r\n    private count: number;\r\n\r\n    constructor() {\r\n        this.items = [];\r\n        this.count = 0;\r\n    }\r\n\r\n    public length() {\r\n        return this.count;\r\n    }\r\n\r\n    public push(item: IExpression) {\r\n        this.items.push(item);\r\n        this.count = this.count + 1;\r\n    }\r\n\r\n    public pop(): IExpression {\r\n        if (this.count > 0) {\r\n            this.count = this.count - 1;\r\n        }\r\n\r\n        return this.items.pop();\r\n    }\r\n\r\n    public peek(steps: number = 0): IExpression {\r\n        if ((this.count + steps) <= 1)\r\n            return <any>{ // dummy\r\n                type: 0\r\n            };\r\n\r\n        return this.items[this.count - 2 + steps]; // current object is always last\r\n    }\r\n}\r\n\r\nexport class ExpressionVisitor implements IExpressionVisitor {\r\n    protected _lambdaExpression: LambdaExpression;\r\n    private _expressionStack: ExpressionStack;\r\n\r\n    constructor() {\r\n        this._expressionStack = new ExpressionStack();\r\n    }\r\n\r\n    public get stack(): ExpressionStack {\r\n        return this._expressionStack;\r\n    }\r\n\r\n    public visitOData(filter: string): IExpression {\r\n        let ast = ODataParser.parse(filter);\r\n        try {\r\n            if (ast) {\r\n                return this.visit(this.transform(ast));\r\n            }\r\n        }\r\n        catch (ex) {\r\n            throw new Error(ex.message);\r\n        }\r\n\r\n        return null;\r\n    }\r\n\r\n    public visitLambdaExpression(expression: string): IExpression {\r\n        if (expression) {\r\n            let ast = JavascriptParser.parse(expression);\r\n            try {\r\n                if (ast) {\r\n                    return this.visit(this.transform(ast));\r\n                }\r\n            }\r\n            catch (ex) {\r\n                throw new Error(ex.message);\r\n            }\r\n        }\r\n\r\n        return null;\r\n    }\r\n\r\n    public visitLambda(predicate: (it: Object, ...param: Array<any>) => any): IExpression {\r\n        var expression = (this._lambdaExpression = new LambdaExpression(predicate)).expression;\r\n\r\n        return this.visitLambdaExpression(expression);\r\n    }\r\n\r\n    public visit(expression: IExpression): IExpression {\r\n        return expression.accept(this);\r\n    }\r\n\r\n    public visitLiteral(expression: ILiteralExpression): IExpression {\r\n        return expression;\r\n    }\r\n\r\n    public visitArray(expression: IArrayExpression): IExpression {\r\n        expression.elements = expression.elements.map((element) => element.accept(this));\r\n\r\n        return expression;\r\n    }\r\n\r\n    public visitTemplateLiteral(expression: ITemplateLiteralExpression): IExpression {\r\n        expression.elements = expression.elements.map((element) => element.accept(this));\r\n\r\n        return expression;\r\n    }\r\n\r\n    public visitObject(expression: IObjectExpression): IExpression {\r\n        expression.properties = expression.properties.map((element) => <IObjectProperty>{ key: element.key.accept(this), value: element.value.accept(this) });\r\n\r\n        return expression;\r\n    }\r\n\r\n    public visitIndex(expression: IIndexExpression): IExpression {\r\n        expression.index = expression.index.accept(this);\r\n        expression.object = expression.object.accept(this);\r\n\r\n        return expression;\r\n    }\r\n\r\n    public visitCompound(expression: ICompoundExpression): IExpression {\r\n        expression.body = expression.body.map((expr) => expr.accept(this));\r\n\r\n        return expression;\r\n    }\r\n\r\n    public visitIdentifier(expression: IIdentifierExpression): IExpression {\r\n        return expression;\r\n    }\r\n\r\n    public visitBinary(expression: IBinaryExpression): IExpression {\r\n        expression.left = expression.left.accept(this);\r\n        expression.right = expression.right.accept(this);\r\n\r\n        return expression;\r\n    }\r\n\r\n\r\n    public visitMethod(expression: IMethodExpression): IExpression {\r\n        if(expression.caller)\r\n            expression.caller = expression.caller.accept(this);\r\n\r\n        expression.parameters = expression.parameters.map((arg) => arg.accept(this));\r\n\r\n        return expression;\r\n    }\r\n\r\n\r\n    public visitUnary(expression: IUnaryExpression): IExpression {\r\n        expression.argument = expression.argument.accept(this);\r\n\r\n        return expression;\r\n    }\r\n\r\n    public visitMember(expression: IMemberExpression): IExpression {\r\n        expression.object = expression.object.accept(this);\r\n        expression.property = expression.property.accept(this);\r\n\r\n        return expression;\r\n    }\r\n\r\n    public visitLogical(expression: ILogicalExpression): IExpression {\r\n        expression.left = expression.left.accept(this);\r\n        expression.right = expression.right.accept(this);\r\n\r\n        return expression;\r\n    }\r\n\r\n    public visitConditional(expression: IConditionalExpression): IExpression {\r\n        expression.condition = expression.condition.accept(this);\r\n        expression.success = expression.success.accept(this);\r\n        expression.failure = expression.failure.accept(this);\r\n\r\n        return expression;\r\n\r\n    }\r\n\r\n    /**\r\n     * transform pegjs expression ast tree to our internal ast tree to make it easier to swap expression parser at a later time\r\n     * @see\r\n     * http://www.odata.org/documentation/odata-version-2-0/uri-conventions/\r\n     *\r\n     * @param expression pegjs expression object\r\n     * @returns \r\n     */\r\n    private transform(expression: any): IExpression {\r\n        var child: IExpression;\r\n\r\n        switch (expression.type) {\r\n            case 'Identifier':\r\n                return new IdentifierExpression(expression.name);\r\n\r\n            case 'MemberExpression':\r\n                switch (expression.property.type)\r\n                {\r\n                    case 'CallExpression':\r\n                        child = this.transform(expression.property);\r\n                        (<MethodExpression>child).caller = this.transform(expression.object);\r\n\r\n                        return child;\r\n\r\n                    default:\r\n                        return new MemberExpression(this.transform(expression.object), this.transform(expression.property));\r\n                }\r\n                \r\n            case 'CallExpression':\r\n                switch (expression.object.type) {\r\n                    case 'Identifier':\r\n                        return new MethodExpression(expression.object.name, expression.arguments ? expression.arguments.map((arg) => this.transform(arg)) : [], null);\r\n\r\n                    default:\r\n                        throw new Error('Caller of method expression is not a Identifier, but is ' + expression.object.type);\r\n                }\r\n\r\n            case 'DateLiteral':\r\n                return new LiteralExpression(new Date(expression.value))\r\n\r\n            case 'NumberLiteral':\r\n                return new LiteralExpression(Number(expression.value))\r\n\r\n            case 'BooleanLiteral':\r\n                return new LiteralExpression(expression.value == true || expression.value == 'true' ? true : false);\r\n\r\n            case 'NullLiteral':\r\n                return new LiteralExpression(null);\r\n\r\n            case 'Literal':\r\n                return new LiteralExpression(expression.value)\r\n\r\n            case 'ConditionalExpression':\r\n                return new ConditionalExpression(this.transform(expression.test), this.transform(expression.left), this.transform(expression.right));\r\n\r\n            case 'ObjectLiteral':\r\n                return new ObjectExpression(expression.properties ? \r\n                    expression.properties.map(({key, value}) => {\r\n                        switch(key.type) {\r\n                            case 'Identifier':\r\n                                key = {\r\n                                    type: 'Literal',\r\n                                    value: key.name\r\n                                }\r\n                                break;\r\n                            default:\r\n                                break;\r\n                        }\r\n                        return { key: this.transform(key), value: this.transform(value) }\r\n                    }) : []);\r\n\r\n            case 'TemplateLiteral':\r\n                if(expression.values && expression.values.length > 0) {\r\n                    let literals: Array<ILiteralExpression> = [], \r\n                        expressions: Array<IExpression> = [],\r\n                        first = expression.values[0];\r\n\r\n                    if(first.type == 'TemplateExpression') \r\n                        literals.push(<ILiteralExpression>this.transform({ type: 'Literal', value: '' }))\r\n\r\n                    literals.push(...expression.values.filter(value => value.type == 'Literal').map(value => this.transform(value)).map(literal => { literal.value = literal.value.replace(/(\\\\)?\\$(\\\\)?\\{/g, '${'); return literal; }));\r\n                    expressions.push(...expression.values.filter(value => value.type == 'TemplateExpression').map(value => this.transform(value.value)));\r\n\r\n                    return new TemplateLiteralExpression(literals, expressions);\r\n                }\r\n\r\n                return new TemplateLiteralExpression([], []);\r\n\r\n            case 'ArrayExpression':\r\n                return new IndexExpression(this.transform(expression.object), this.transform(expression.index))\r\n\r\n            case 'ArrayLiteral':\r\n                return new ArrayExpression(expression.elements ? expression.elements.map((arg) => this.transform(arg)) : []);\r\n\r\n            case 'LogicalExpression':\r\n            case 'LogicalExpression':\r\n                switch (expression.operator) {\r\n                    case '&&':\r\n                        return new LogicalExpression(LogicalOperatorType.And, this.transform(expression.left), this.transform(expression.right));\r\n                    case '||':\r\n                        return new LogicalExpression(LogicalOperatorType.Or, this.transform(expression.left), this.transform(expression.right));\r\n                }\r\n                break;\r\n\r\n            case 'RelationalExpression':\r\n                switch (expression.operator) {\r\n                    case '==': // equal\r\n                        return new LogicalExpression(LogicalOperatorType.Equal, this.transform(expression.left), this.transform(expression.right));\r\n\r\n                    case '!=': // not equal\r\n                        return new LogicalExpression(LogicalOperatorType.NotEqual, this.transform(expression.left), this.transform(expression.right));\r\n\r\n                    case '<': // lesser\r\n                        return new LogicalExpression(LogicalOperatorType.Lesser, this.transform(expression.left), this.transform(expression.right));\r\n\r\n                    case '<=': // lesser or equal\r\n                        return new LogicalExpression(LogicalOperatorType.LesserOrEqual, this.transform(expression.left), this.transform(expression.right));\r\n\r\n                    case '>': // greater\r\n                        return new LogicalExpression(LogicalOperatorType.Greater, this.transform(expression.left), this.transform(expression.right));\r\n\r\n                    case '>=': // greater or equal\r\n                        return new LogicalExpression(LogicalOperatorType.GreaterOrEqual, this.transform(expression.left), this.transform(expression.right));\r\n                }\r\n                break;\r\n\r\n            case 'PostfixExpression':\r\n                switch (expression.operator)\r\n                {\r\n                    case '--':\r\n                        return new UnaryExpression(UnaryOperatorType.Decrement, UnaryAffixType.Postfix, this.transform(expression.argument));\r\n                    case '++':\r\n                        return new UnaryExpression(UnaryOperatorType.Increment, UnaryAffixType.Postfix, this.transform(expression.argument));\r\n                }\r\n                break;\r\n\r\n            case 'UnaryExpression':\r\n                switch (expression.operator) {\r\n                    case '!':\r\n                        return new UnaryExpression(UnaryOperatorType.Invert, UnaryAffixType.Prefix, this.transform(expression.argument));\r\n                    case '~':\r\n                        return new UnaryExpression(UnaryOperatorType.Complement, UnaryAffixType.Prefix, this.transform(expression.argument));\r\n                    case '+':\r\n                        return new UnaryExpression(UnaryOperatorType.Positive, UnaryAffixType.Prefix, this.transform(expression.argument));\r\n                    case '-':\r\n                        return new UnaryExpression(UnaryOperatorType.Negative, UnaryAffixType.Prefix, this.transform(expression.argument));\r\n                    case '--':\r\n                        return new UnaryExpression(UnaryOperatorType.Decrement, UnaryAffixType.Prefix, this.transform(expression.argument));\r\n                    case '++':\r\n                        return new UnaryExpression(UnaryOperatorType.Increment, UnaryAffixType.Prefix, this.transform(expression.argument));\r\n                }\r\n                break;\r\n\r\n            case 'ShiftExpression':\r\n                switch (expression.operator)\r\n                {\r\n                    case '<<':\r\n                        return new BinaryExpression(BinaryOperatorType.LeftShift, this.transform(expression.left), this.transform(expression.right));\r\n                    case '>>':\r\n                        return new BinaryExpression(BinaryOperatorType.RightShift, this.transform(expression.left), this.transform(expression.right));\r\n                    case '>>>': // zero-fill right-shift \r\n                        return new BinaryExpression(BinaryOperatorType.RightShift, this.transform(expression.left), this.transform(expression.right));\r\n                }\r\n                break;\r\n\r\n            case 'BitwiseExpression':\r\n                switch (expression.operator)\r\n                {\r\n                    case '|':\r\n                        return new BinaryExpression(BinaryOperatorType.Or, this.transform(expression.left), this.transform(expression.right));\r\n                    case '^':\r\n                        return new BinaryExpression(BinaryOperatorType.ExclusiveOr, this.transform(expression.left), this.transform(expression.right));\r\n                    case '&':\r\n                        return new BinaryExpression(BinaryOperatorType.And, this.transform(expression.left), this.transform(expression.right));\r\n                }\r\n                break;\r\n\r\n            case 'BinaryExpression':\r\n                switch (expression.operator) {\r\n                    case '+': // addition\r\n                        return new BinaryExpression(BinaryOperatorType.Addition, this.transform(expression.left), this.transform(expression.right));\r\n\r\n                    case '-': // subtraction\r\n                        return new BinaryExpression(BinaryOperatorType.Subtraction, this.transform(expression.left), this.transform(expression.right));\r\n\r\n                    case '*': // multiplication\r\n                        return new BinaryExpression(BinaryOperatorType.Multiplication, this.transform(expression.left), this.transform(expression.right));\r\n\r\n                    case '/': // division\r\n                        return new BinaryExpression(BinaryOperatorType.Division, this.transform(expression.left), this.transform(expression.right));\r\n\r\n                    case '%': // modulus\r\n                        return new BinaryExpression(BinaryOperatorType.Modulus, this.transform(expression.left), this.transform(expression.right));\r\n                }\r\n                break;                \r\n        }\r\n\r\n        throw new Error('Expression type \"' + expression.type + '\" is unknown');\r\n    }\r\n\r\n  \r\n}\r\n\r\n//export { IExpression, Expression, ExpressionType } from './expression';\r\n//export { IArrayExpression, IBinaryExpression, ICompoundExpression, IConditionalExpression, IIdentifierExpression, ILiteralExpression, ILogicalExpression, IMemberExpression, IMethodExpression, IUnaryExpression }\r\n\r\nexport { IExpression, Expression, ExpressionType } from './expression';\r\nexport { ILiteralExpression, LiteralExpression } from './literalexpression';\r\nexport { ICompoundExpression } from './compoundexpression';\r\nexport { IIdentifierExpression, IdentifierExpression } from './identifierexpression';\r\nexport { IMemberExpression, MemberExpression } from './memberexpression';\r\nexport { IMethodExpression, MethodExpression } from './methodexpression';\r\nexport { IUnaryExpression, UnaryExpression, UnaryOperatorType, UnaryAffixType } from './unaryexpression';\r\nexport { IBinaryExpression, BinaryExpression, BinaryOperatorType } from './binaryexpression';\r\nexport { ILogicalExpression, LogicalExpression, LogicalOperatorType } from './logicalexpression';\r\nexport { IConditionalExpression, ConditionalExpression } from './conditionalexpression';\r\nexport { IArrayExpression, ArrayExpression } from './arrayexpression';\r\nexport { IIndexExpression, IndexExpression } from './indexexpression';\r\nexport { ITemplateLiteralExpression, TemplateLiteralExpression } from './templateliteralexpression';\r\nexport { IObjectExpression, ObjectExpression, IObjectProperty } from './objectexpression';"]}